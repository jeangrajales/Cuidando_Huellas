<!-- Modal Carrito -->
<div class="modal fade" id="modalCarrito" tabindex="-1" aria-labelledby="modalCarritoLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <div id="notificaciones">
            {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{% if message.tags and message.tags != 'error' %}{{ message.tags }}{% else %}danger{% endif %} alert-dismissible fade show text-center" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
            {% endif %}
          </div>
          <h5 class="modal-title" id="modalCarritoLabel">Tu carrito de compras</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          {% if carrito and carrito.items.all %}
            <table class="table align-middle">
              <thead>
                <tr>
                  <th>Producto</th>
                  <th>Precio</th>
                  <th>Cantidad</th>
                  <th>Subtotal</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                {% for item in carrito.items.all %}
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        {% if item.producto.foto_producto %}
                          <img src="{{ item.producto.foto_producto.url }}" alt="{{ item.producto.nombre_producto }}" width="60" class="me-2 rounded">
                        {% endif %}
                        <span>{{ item.producto.nombre_producto }}</span>
                      </div>
                    </td>
                    <td>${{ item.producto.precio|floatformat:0 }}</td>
                    <td>{{ item.cantidad }}</td>
                    <td>${{ item.subtotal|floatformat:0 }}</td>
                    <td>
                      <a href="{% url 'aumentar_cantidad' item.id %}#modalCarrito" class="btn btn-sm btn-success">+</a>
                      <a href="{% url 'disminuir_cantidad' item.id %}#modalCarrito" class="btn btn-sm btn-warning">-</a>
                      <a href="{% url 'eliminar_item' item.id %}#modalCarrito" class="btn btn-sm btn-danger">ðŸ—‘</a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
            <div class="text-end fw-bold fs-5">Total: ${{ carrito.total|floatformat:0 }}</div>
          {% else %}
            <div class="text-center py-4">
              <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
              <p class="lead">Tu carrito estÃ¡ vacÃ­o.</p>
              <p class="text-muted">Agrega productos para realizar tu compra.</p>
            </div>
          {% endif %}
        </div>
        <div class="modal-footer">
          {% if carrito and carrito.items.all %}
            <a href="{% url 'vaciar_carrito' %}#modalCarrito" class="btn btn-outline-danger">
              <i class="fas fa-trash-alt me-1"></i> Vaciar carrito
            </a>
            <a href="{% url 'generar_factura' %}" class="btn btn-success">
              <i class="fas fa-cash-register me-1"></i> Pagar ahora
            </a>
          {% endif %}
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
            <i class="fas fa-shopping-cart me-1"></i> Seguir Comprando
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Script para mantener el modal abierto si URL contiene #modalCarrito -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      if (window.location.hash === "#modalCarrito") {
        var modal = new bootstrap.Modal(document.getElementById('modalCarrito'));
        modal.show();
      }
    });
  </script>
  